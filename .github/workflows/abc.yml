name: 'Approved Fork Execution'

on:
  pull_request_target:

jobs:
  run-tests:
    name: 'Run Tests'
    runs-on: 'ubuntu-latest'

    # For PRs from forks, require approval via an environment.
    # For internal PRs (from the same repo), run without approval.
    environment: ${{ github.event.pull_request.head.repo.fork == true && 'e2e-on-fork' || null }}

    steps:
      # We must checkout the specific PR head SHA because this workflow runs in the context
      # of the base branch, not the PR merge commit.
      - name: 'Checkout PR code'
        uses: 'actions/checkout@v4'
        with:
          ref: '${{ github.event.pull_request.head.sha }}'

      - name: 'Run test with secret'
        env:
          GEMINI_API_KEY: '${{ secrets.GEMINI_API_KEY }}'
        run: |
          echo "This step demonstrates using a secret."
          if [ -n "$GEMINI_API_KEY" ]; then
            echo "GEMINI_API_KEY is available."
          else
            echo "GEMINI_API_KEY is not available."
            exit 1
          fi
